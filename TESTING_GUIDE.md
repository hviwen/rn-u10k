# 导航架构优化测试指南

## 🎯 测试目标

验证优化后的导航架构是否达到以下目标：
1. 所有详情页面有且仅有一个导航栏和返回按钮
2. 从深层页面返回 tab 首页时清空导航栈
3. 导航行为在所有场景下保持一致

## 🧪 详细测试场景

### 测试场景 1：首次跳转一致性测试

#### 1.1 从 Home Tab 跳转
**操作步骤：**
1. 启动应用，确保在 Home tab
2. 点击任意一个 "View user details" 链接
3. 观察详情页面的导航栏

**预期结果：**
- ✅ 显示单一导航栏（Home Detail 标题，橙色背景）
- ✅ 左上角显示 "返回" 按钮
- ✅ 无导航栏重叠或闪烁
- ✅ 支持滑动返回手势

#### 1.2 从 Settings Tab 跳转
**操作步骤：**
1. 切换到 Settings tab
2. 点击 "Go to Setting Detail" 按钮
3. 观察详情页面的导航栏

**预期结果：**
- ✅ 显示单一导航栏（Settings Detail 标题，蓝色背景）
- ✅ 左上角显示 "返回" 按钮
- ✅ 无导航栏重叠或闪烁
- ✅ 支持滑动返回手势

### 测试场景 2：详情页面内跳转测试

#### 2.1 同模块内跳转
**操作步骤：**
1. 进入任意详情页面
2. 点击 "跳转到另一个XXX页面" 按钮
3. 观察新页面的导航栏

**预期结果：**
- ✅ 新页面导航栏与首次跳转完全一致
- ✅ 返回按钮正常显示和工作
- ✅ 可以通过返回按钮逐级返回

#### 2.2 跨模块跳转
**操作步骤：**
1. 在 Home Detail 页面
2. 点击 "跳转到 Settings 详情页"
3. 观察 Settings Detail 页面

**预期结果：**
- ✅ Settings Detail 页面导航栏正确（蓝色背景）
- ✅ 返回按钮正常显示
- ✅ 导航栈正确管理

### 测试场景 3：导航栈清空测试

#### 3.1 复杂导航路径测试
**操作步骤：**
1. Home Tab → Home Detail (页面A)
2. 页面A → Settings Detail (页面B)  
3. 页面B → Home Detail (页面C)
4. 在页面C点击 "返回Home主页"

**预期结果：**
- ✅ 直接返回到 Home Tab 首页
- ✅ 页面A、B、C 全部从导航栈中移除
- ✅ 无法通过系统返回按钮回到中间页面

#### 3.2 Settings 路径测试
**操作步骤：**
1. Settings Tab → Settings Detail (页面A)
2. 页面A → Home Detail (页面B)
3. 在页面B点击 "返回Settings主页"

**预期结果：**
- ✅ 直接返回到 Settings Tab 首页
- ✅ 页面A、B 全部从导航栈中移除

### 测试场景 4：特殊功能测试

#### 4.1 倒计时功能测试（Home 模块）
**操作步骤：**
1. 进入 Home Detail 页面
2. 等待倒计时开始（约3秒）
3. 观察导航栏隐藏
4. 等待倒计时结束
5. 观察导航栏重新显示

**预期结果：**
- ✅ 倒计时开始时导航栏完全隐藏
- ✅ 倒计时结束时导航栏正确恢复
- ✅ 恢复后的导航栏包含正确的返回按钮
- ✅ 返回按钮功能正常

#### 4.2 页面切换测试
**操作步骤：**
1. 在详情页面时切换到其他 tab
2. 再切换回原 tab
3. 观察详情页面状态

**预期结果：**
- ✅ 详情页面状态保持
- ✅ 导航栏配置正确
- ✅ 返回按钮正常工作

## 🔍 问题排查指南

### 常见问题及解决方案

#### 问题1：返回按钮不显示
**可能原因：**
- 根 layout 配置错误
- 组件内 navigation.setOptions 覆盖了配置

**排查步骤：**
1. 检查 `app/_layout.tsx` 中的 Stack.Screen 配置
2. 检查详情页面组件中的 useEffect 设置

#### 问题2：导航栈未清空
**可能原因：**
- 使用了 router.back() 而不是 router.navigate()
- 路径配置错误

**排查步骤：**
1. 确认 handleNavigateBack 函数使用 router.navigate()
2. 检查路径格式是否正确

#### 问题3：导航栏样式错误
**可能原因：**
- moduleConfig 配置错误
- headerStyle 设置问题

**排查步骤：**
1. 检查 moduleConfig 中的 headerStyle 配置
2. 确认 useEffect 中正确设置了样式

## 📊 性能验证

### 内存使用测试
1. 使用 React DevTools 监控组件树
2. 验证删除的 layout 组件不再存在
3. 检查导航栈深度是否减少

### 渲染性能测试
1. 使用 Flipper 或 React DevTools Profiler
2. 对比优化前后的渲染时间
3. 验证页面切换流畅度

## ✅ 验收标准

### 功能验收
- [ ] 所有测试场景通过
- [ ] 无导航栏重叠或异常
- [ ] 返回按钮在所有场景下正常工作
- [ ] 导航栈清空功能正常

### 性能验收
- [ ] 页面切换流畅，无明显延迟
- [ ] 内存使用优化，无内存泄漏
- [ ] 导航栈深度减少

### 用户体验验收
- [ ] 导航行为直观一致
- [ ] 返回逻辑符合用户预期
- [ ] 手势导航正常工作
