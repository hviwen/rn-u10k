# 导航返回按钮修复测试计划

## 修复内容总结

### 问题原因分析
1. **导航栈层级差异**：首次跳转跨越了 Tab Navigator 和 Stack Navigator
2. **配置冲突**：`headerLeft: () => null` 实际上禁用了自定义 headerLeft，但不等同于强制显示默认返回按钮
3. **配置优先级**：layout 文件和组件内的 navigation.setOptions 存在优先级冲突

### 修复方案
1. **移除 headerLeft 配置**：从 moduleConfig 中移除 `headerLeft: () => null`，让系统自动处理返回按钮
2. **添加 headerBackTitle**：为每个模块配置添加 `headerBackTitle: "返回"`
3. **优化导航选项设置**：
   - 使用 `useEffect` 确保组件挂载时立即设置导航选项
   - 使用 `useFocusEffect` 确保每次页面获得焦点时重新设置
   - 设置 `headerLeft: undefined` 让系统自动处理
4. **修复 showHeader 函数**：确保重新显示 header 时包含完整的返回按钮配置

## 测试场景

### 场景 1：从 Home Tab 首次跳转
1. 打开应用，进入 Home tab
2. 点击任意一个 "View user details" 链接
3. **预期结果**：详情页面左上角应显示返回按钮

### 场景 2：从 Settings Tab 首次跳转
1. 打开应用，进入 Settings tab
2. 点击 "Go to Setting Detail" 按钮
3. **预期结果**：详情页面左上角应显示返回按钮

### 场景 3：详情页面内部跳转
1. 在任意详情页面内
2. 点击 "跳转到另一个XXX页面" 按钮
3. **预期结果**：新打开的详情页面左上角应显示返回按钮

### 场景 4：跨模块跳转
1. 在 Home 详情页面内
2. 点击 "跳转到 Settings 详情页"
3. **预期结果**：Settings 详情页面左上角应显示返回按钮

### 场景 5：倒计时功能测试（Home 模块特有）
1. 进入 Home 详情页面
2. 等待倒计时开始（header 隐藏）
3. 等待倒计时结束（header 重新显示）
4. **预期结果**：header 重新显示时，返回按钮应该正常显示

### 场景 6：返回按钮功能测试
1. 在任意详情页面
2. 点击左上角的返回按钮
3. **预期结果**：应该正确返回到上一个页面

## 技术验证点

1. **导航栈一致性**：确保所有跳转场景下导航栈结构正确
2. **配置优先级**：验证组件内的 navigation.setOptions 正确覆盖了 layout 配置
3. **生命周期正确性**：useEffect 和 useFocusEffect 的执行时机正确
4. **手势导航**：确保 gestureEnabled 配置生效，支持滑动返回

## 预期改进效果

1. **一致性**：所有跳转场景下返回按钮显示行为完全一致
2. **可靠性**：不再依赖导航栈层级，配置更加健壮
3. **用户体验**：用户在任何情况下都能看到并使用返回按钮
4. **维护性**：配置逻辑更清晰，易于理解和维护
